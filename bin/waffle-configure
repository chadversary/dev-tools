#!/usr/bin/env bash

set -eu

: ${PREFIX:=}
: ${USE:=}

prog="${0##*/}"

die() {
    printf >&2 "%s\n" "$prog: error: $@"
    exit 1
}

use() {
    [[ ",${USE}," = *,$1,* ]]
}

cmake_opts=(
    -GNinja
    -DCMAKE_INSTALL_PREFIX="$PREFIX"
    -DCMAKE_INSTALL_LIBDIR='lib'
    -Dwaffle_build_examples=1
    -Dwaffle_build_htmldocs=1
    -Dwaffle_build_manpages=1
    "$@"
)

if use debug; then
    cmake_opts+=("-DCMAKE_BUILD_TYPE=Debug")
fi

if [[ "$PREFIX" ]]; then
    cmake_opts+=("-DCMAKE_INSTALL_PREFIX=$PREFIX")
fi

cmake "${cmake_opts[@]}" .
